<!DOCTYPE html>
<html lang="pt-br">
<head>
	<title>Trabalho do Roland</title>
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="_style/estilo.css" />
</head>
<body>
	<script src="_bibliotecagrafico/code/highcharts.js"></script>
	<script src="_bibliotecagrafico/code/highcharts-3d.js"></script>
	<script src="_bibliotecagrafico/code/modules/exporting.js"></script>
	<form id="formcoluna">
		<p><label for="escolheColuna">Escolha os dados a ser mostrado pelo grafico
		<select id="colunaescolhida" name="escolheColuna" onchange="teste()">
			<option value="4">Período</option>
			<option value="6">Idade</option>
			<option value="7">Estado Civil</option>
			<option value="8">Deficiencia</option>
			<option value="10">Tem Filhos</option>
			<option value="15">Município</option>
			<option value="22">Locomoção</option>
			<option value="23">Moradia</option>
			<option value="25">Com quem mora</option>
			<option value="26">Quantidade na Família</option>
			<option value="27">Quantos Trabalham</option>
			<option value="28">Quantidade de Salário Minímo</option>
			<option value="29">Trabalho</option>
			<option value="31">Vida escolar</option>
			<option value="32">Informática</option>
			<option value="34">Idioma</option>
		</select></label></p>
	</form>
	<form id="formulario">
		<p><label for="coletaCSV">Insira seu arquivo CSV<input type="file" name="coletaCSV" id="inputCSV" onchange="pegaCSV(this)" /></label></p>
	</form>
	<form id="selGrafico">
		<p>Escolha o tipo de grafico
		<select id="grafico" onchange="graphic()">
			<option >Pizza</option>
			<option >Coluna</option>
		</select></p>
	</form>
	<div id="container" ></div>
	<script type="text/javascript">
		var colunaescolhida = parseInt(document.getElementById('colunaescolhida').value);
		var nomeSerie = document.getElementById('colunaescolhida').options[document.getElementById('colunaescolhida').selectedIndex].text;
		var fileArr;
		var leitorDeCSV = new FileReader();
		var fileColumn = [];
		var valores = [];
		var dados = [];
		

		window.onload = function init(){
			leitorDeCSV.onload = leCSV
		}

		function pegaCSV(inputFile) {
			var file = inputFile.files[0];
			leitorDeCSV.readAsText(file);
		}

		function leCSV(evt){
			fileArr = evt.target.result.split('\n');
			fileArr.toString();
			teste();
		}		

		function teste(){	
			colunaescolhida = parseInt(document.getElementById('colunaescolhida').value);
			dados = [];
			valores = [];
			for (var i = 0; i<fileArr.length-1; i++){
				var fileLine = fileArr[i].split(',');
				var y = fileLine[colunaescolhida];
				//tira aspas
				if(y != null && y != "" && y != undefined){
					var x = y.replace(/"/g, '');
				}
				
				if(dados.indexOf(x) == -1){
					dados.push(x);
				}
				
				var indice = dados.indexOf(x);
				if (valores[indice] == null) {
					valores[indice] = 0;
				}
				
				valores[indice]++;
			}
			
			graphic();
		}	

		function graphic(){
			var escolhaGrafico = document.getElementById('grafico').value;
			if (escolhaGrafico == "Pizza") {
				Highcharts.chart('container', {
				    chart: {
				        type: 'pie',
				        options3d: {
				            enabled: true,
				            alpha: 45,
				            beta: 0
				        }
				    },
				    title: {
				        text: 'Browser market shares at a specific website, 2014'
				    },
				    tooltip: {
				        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
				    },
				    plotOptions: {
				        pie: {
				            allowPointSelect: true,
				            cursor: 'pointer',
				            depth: 35,
				            dataLabels: {
				                enabled: true,
				                format: dados
				            }
				        }
				    },
				    series: [{
				        type: 'pie',
				        name: 'Browser share',
				        data: valores,
				    }]
				});		

			}
			else if (escolhaGrafico == 'Coluna'){
				Highcharts.chart('container', {
				    chart: {
				        type: 'column',
				        options3d: {
				            enabled: true,
				            alpha: 10,
				            beta: 25,
				            depth: 70
				        }
				    },
				    title: {
				        text: nomeSerie,
				    },
				    subtitle: {
				        text: ''
				    },
				    plotOptions: {
				        column: {
				            depth: 25
				        }
				    },
				    xAxis: {
				        categories: dados,
				        labels: {
				            skew3d: true,
				            style: {
				                fontSize: '16px'
				            }
				        }
				    },
				    yAxis: {
				        title: {
				            text: null
				        }
				    },
				    series: [{
				        name: [nomeSerie],
				        data: valores
				    }]
				});
			}
		};
	</script>

</body>
</html>
<!DOCTYPE html>
<html lang="pt-br">
<head>
	<title>Trabalho do Roland</title>
	<meta charset="utf-8" />
	<link rel="stylesheet" type="text/css" href="_style/estilo.css" />
</head>
<body>
	<script src="_bibliotecagrafico/code/highcharts.js"></script>
	<script src="_bibliotecagrafico/code/highcharts-3d.js"></script>
	<script src="_bibliotecagrafico/code/modules/exporting.js"></script>
	<form id="formcoluna">
		<p><label for="escolheColuna">Escolha os dados a ser mostrado pelo grafico
		<select id="colunaescolhida" name="escolheColuna" onchange="teste()">
			<option value="4">Período</option>
			<option value="6">Idade</option>
			<option value="7">Estado Civil</option>
			<option value="8">Deficiencia</option>
			<option value="10">Tem Filhos</option>
			<option value="14">Município</option>
			<option value="21">Locomoção</option>
			<option value="22">Moradia</option>
			<option value="24">Com quem mora</option>
			<option value="25">Quantidade na Família</option>
			<option value="26">Quantos Trabalham</option>
			<option value="27">Quantidade de Salário Minímo</option>
			<option value="28">Trabalho</option>
			<option value="30">Vida escolar</option>
			<option value="31">Informática</option>
			<option value="33">Idioma</option>
		</select></label></p>
	</form>
	<form id="formulario">
		<p><label for="coletaCSV">Insira seu arquivo CSV<input type="file" name="coletaCSV" id="inputCSV" onchange="pegaCSV(this)" /></label></p>
	</form>
	<form id="selGrafico">
		<p>Escolha o tipo de grafico
		<select id="grafico" onchange="graphic()">
			<option >Pizza</option>
			<option >Coluna</option>
		</select></p>
	</form>
	<div id="container" ></div>
	<script type="text/javascript">
		var colunaescolhida = parseInt(document.getElementById('colunaescolhida').value);
		var nomeSerie = document.getElementById('colunaescolhida').options[document.getElementById('colunaescolhida').selectedIndex].text;
		var fileArr;
		var leitorDeCSV = new FileReader();
		var fileColumn = [];
		var a = 0;
		var b = 0;
		var c = 0;
		var d = 0;
		var dados1, dados2, dados3, dados4 = "";
		

		window.onload = function init(){
			leitorDeCSV.onload = leCSV
		}

		function pegaCSV(inputFile) {
			var file = inputFile.files[0];
			leitorDeCSV.readAsText(file);
		}

		function leCSV(evt){
			condicao();
			fileArr = evt.target.result.split('\n');
			fileArr.toString();
			teste();
		}		

		function teste(){	
			condicao();
			a = 0;
			b = 0;
			c = 0;
			d = 0;
			for (var i = 0; i<fileArr.length; i++){
				var fileLine = fileArr[i].split(',');
				var x = fileLine[colunaescolhida];
				if (x == dados1 && x != undefined) {
					a++;
				}
				else if(x == dados2 && x != undefined){
					b++;
				}
				else if(x == dados3 && x != undefined){
					c++;
				}
				else if(x == dados4 && x != undefined){
					d++;
				}
				if (c == 0) {
					c = null;
					d = null;
				}
				else if(d == 0){
					d == null;
				}
			}
			graphic();
		}	

		function condicao(){
			colunaescolhida = parseInt(document.getElementById('colunaescolhida').value);
			nomeSerie = document.getElementById('colunaescolhida').options[document.getElementById('colunaescolhida').selectedIndex].text;
			if (colunaescolhida == 4){
				dados1 = '"MANHA"';
				dados2 = '"NOITE"';
				dados3 = "";
				dados4 = "";
			}
			else if ((colunaescolhida == 8) || (colunaescolhida == 10) || (colunaescolhida == 31)){
				dados1 = '"NAO"';
				dados2 = '"SIM"';
				dados3 = "";
				dados4 = false;
			}
			else if (colunaescolhida == 7) {
				dados1 = '"SOLTEIRO(A)"';
				dados2 = '"CASADO(A)"';
				dados3 = '"OUTROS"';
				dados4 = "";
			}
			else if (colunaescolhida == 6){
				dados1 = "ate 20 anos";
				dados2 = "de 21 a 30";
				dados3 = "de 31 a 40";
				dados4 = "acima de 40";
			}

		}

		function graphic(){
			var escolhaGrafico = document.getElementById('grafico').value;
			if (escolhaGrafico == "Pizza") {
				Highcharts.chart('container', {
				    chart: {
				        type: 'pie',
				        options3d: {
				            enabled: true,
				            alpha: 45,
				            beta: 0
				        }
				    },
				    title: {
				        text: 'Browser market shares at a specific website, 2014'
				    },
				    tooltip: {
				        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
				    },
				    plotOptions: {
				        pie: {
				            allowPointSelect: true,
				            cursor: 'pointer',
				            depth: 35,
				            dataLabels: {
				                enabled: true,
				                format: '{point.name}'
				            }
				        }
				    },
				    series: [{
				        type: 'pie',
				        name: 'Browser share',
				        data: [
				            [dados1, a],
				            [dados2, b],
				            [dados3, c],
				            [dados4, d],
				        ]
				    }]
				});		

			}
			else if (escolhaGrafico == 'Coluna'){
				Highcharts.chart('container', {
				    chart: {
				        type: 'column',
				        options3d: {
				            enabled: true,
				            alpha: 10,
				            beta: 25,
				            depth: 70
				        }
				    },
				    title: {
				        text: nomeSerie,
				    },
				    subtitle: {
				        text: ''
				    },
				    plotOptions: {
				        column: {
				            depth: 25
				        }
				    },
				    xAxis: {
				        categories: [dados1, dados2, dados3, dados4],
				        labels: {
				            skew3d: true,
				            style: {
				                fontSize: '16px'
				            }
				        }
				    },
				    yAxis: {
				        title: {
				            text: null
				        }
				    },
				    series: [{
				        name: [nomeSerie],
				        data: [a, b, c, d]
				    }]
				});
			}
		};
	</script>

</body>
</html>